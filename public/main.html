<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Attendance Management System</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* minimal inline styles so page looks okay if style.css missing */
    body { font-family: Arial, sans-serif; margin: 16px; background:#f3f4f6; color:#111; }
    .container { max-width:1100px; margin:0 auto; }
    .card { background:#fff; padding:16px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,.04); margin-bottom:14px; }
    .form-row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; }
    .form-group { display:flex; flex-direction:column; gap:6px; min-width:160px; }
    input, select { padding:8px 10px; border:1px solid #ddd; border-radius:6px; }
    .btn { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .btn-primary{ background:#4f46e5; color:#fff; }
    .btn-success{ background:#10b981; color:#fff; }
    .btn-danger{ background:#ef4444; color:#fff; }
    .btn-warning{ background:#f59e0b; color:#fff; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:8px; border-bottom:1px solid #eee; text-align:left; }
    .subjects-container { display:grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap:12px; }
    .subject-card { padding:12px; border-radius:8px; background:#fff; box-shadow:0 6px 12px rgba(0,0,0,0.04); }
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:9999; }
    .modal-content { background:#fff; padding:16px; border-radius:10px; width:95%; max-width:900px; max-height:80vh; overflow:auto; }
    .close { float:right; cursor:pointer; font-size:20px; }
    .small { font-size:13px; padding:6px 8px; border-radius:6px; }
    .controls-inline { display:flex; gap:8px; align-items:center; }
  </style>
</head>
<body>
  <div class="container">
    <header class="card" style="display:flex;justify-content:space-between;align-items:center;">
      <div style="display:flex;gap:12px;align-items:center;">
        <i class="fas fa-graduation-cap" style="font-size:28px;color:#4f46e5"></i>
        <div>
          <h1 style="margin:0">Attendance Manager</h1>
          <small>Teacher Dashboard</small>
        </div>
      </div>
      <div id="serverStatus" style="color:#666">Status: --</div>
    </header>

    <!-- Stats -->
    <div class="card" id="statsCard">
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div style="min-width:130px">
          <h3 id="totalSubjects">0</h3><div>Total Subjects</div>
        </div>
        <div style="min-width:130px">
          <h3 id="totalClasses">0</h3><div>Total Classes</div>
        </div>
        <div style="min-width:130px">
          <h3 id="totalPresent">0</h3><div>Classes Attended</div>
        </div>
        <div style="min-width:130px">
          <h3 id="overallPercentage">0%</h3><div>Overall Attendance</div>
        </div>
      </div>
    </div>

    <!-- Add Student -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-user-plus"></i> Add Student</h2>
      <form id="addStudentForm" class="form-row">
        <div class="form-group"><label for="enrollId">Enrollment ID</label><input id="enrollId" required></div>
        <div class="form-group"><label for="studentNameInput">Student Name</label><input id="studentNameInput" required></div>
        <div><button class="btn btn-primary" type="submit">Add Student</button></div>
      </form>
    </div>

    <!-- Students List -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-users"></i> Students</h2>
      <div id="studentsList"></div>
    </div>

    <!-- Add Subject -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-plus-circle"></i> Add Subject</h2>
      <form id="addSubjectForm" class="form-row">
        <div class="form-group"><label for="subjectName">Subject Name</label><input id="subjectName" required></div>
        <div><button class="btn btn-primary" type="submit">Add Subject</button></div>
      </form>
    </div>

    <!-- Quick single mark form -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-clipboard-check"></i> Quick Mark (Single Student)</h2>
      <form id="markAttendanceForm" class="form-row">
        <div class="form-group"><label for="attendanceStudent">Student</label><select id="attendanceStudent"></select></div>
        <div class="form-group"><label for="attendanceSubject">Subject</label><select id="attendanceSubject"></select></div>
        <div class="form-group"><label for="attendanceDate">Date</label><input id="attendanceDate" type="date"></div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-success" type="submit" name="status" value="present">Present</button>
          <button class="btn btn-danger" type="submit" name="status" value="absent">Absent</button>
        </div>
      </form>
    </div>

    <!-- Subject-wise Marking -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-chalkboard-teacher"></i> Mark Attendance (Subject-wise)</h2>
      <div class="form-row" style="align-items:center">
        <div class="form-group"><label for="markSubject">Subject</label><select id="markSubject"></select></div>
        <div class="form-group"><label for="markDate">Date</label><input id="markDate" type="date"></div>
        <div><button id="loadStudentsBtn" class="btn btn-primary">Load Students</button></div>
        <div><button id="clearDayBtn" class="btn btn-warning">Clear Day</button></div>
      </div>

      <div id="subjectStudentsContainer" style="margin-top:12px"></div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="bulkMarkPresent" class="btn btn-success">Mark Selected Present</button>
        <button id="bulkMarkAbsent" class="btn btn-danger">Mark Selected Absent</button>
      </div>
    </div>

    <!-- Subjects cards -->
    <div class="card">
      <h2 style="margin-top:0"><i class="fas fa-list"></i> Subjects</h2>
      <div id="subjectsList" class="subjects-container"></div>
    </div>

    <!-- Attendance History -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 style="margin:0"><i class="fas fa-history"></i> Attendance History</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="filterSubject"><option value="">All Subjects</option></select>
          <button id="refreshBtn" class="btn small">Refresh</button>
        </div>
      </div>
      <div id="attendanceHistory" style="margin-top:12px"></div>
    </div>

    <footer style="text-align:center;margin-top:12px;color:#777">Â© 2025 Attendance Manager</footer>
  </div>

  <!-- modal -->
  <div id="detailsModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close" id="modalClose">&times;</span>
      <h2 id="modalTitle"></h2>
      <div id="modalBody"></div>
    </div>
  </div>

  <script src="index.js"></script>
  <script>
    // modal controls
    document.getElementById('modalClose').addEventListener('click', () => {
      document.getElementById('detailsModal').style.display = 'none';
    });
    window.onclick = (e) => { if (e.target === document.getElementById('detailsModal')) document.getElementById('detailsModal').style.display = 'none'; };

    // quick ping server
    (async function ping(){ try{ const r = await fetch('/ping'); if (r.ok) document.getElementById('serverStatus').textContent = 'Status: Connected'; }catch(e){ document.getElementById('serverStatus').textContent = 'Status: Offline'; } })();
  </script>
</body>
</html>
